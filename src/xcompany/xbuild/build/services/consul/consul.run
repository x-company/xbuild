#!/usr/bin/execlineb -P

# File will called to start your Service

s6-envdir /etc/xbuild/env.d/
importas -u consul_domain CONSUL_DOMAIN
importas -u consul_name_prefix CONSUL_NAME_PREFIX

backtick hostname { hostname -s }
importas -u hostname hostname

/usr/local/bin/consul agent \
    -node="${consul_name_prefix}-${hostname}" \
    -bootstrap-expect=0
    -client=0.0.0.0
    -data-dir=/var/lib/consul
    -domain=${consul_domain}
    -server
