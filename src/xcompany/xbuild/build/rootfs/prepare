#!/usr/bin/execlineb -P

define envdir /etc/xbuild/env.d
if { s6-mkdir -p ${envdir} }

if { s6-echo "[xbuild] Update the Package Sources" }
foreground {
    apt-get -q update
    apt-get install -qy --no-install-recommends apt-utils
    apt-get install -qy --no-install-recommends apt-transport-https
}

if { s6-echo "[xbuild] copy rootfs" }
foreground { s6-hiercopy /build/rootfs / }

if { s6-echo "[xbuild] copy rootfs" }
foreground { s6-hiercopy /build/rootfs / }

if { s6-echo "[xbuild] Reinitialze Package Sources" }
foreground {

    apt-get clean
    apt-get -qy autoremove
    s6-rmrf /var/lib/apt/lists/*
    apt-get -q update
}

if { s6-echo "[xbuild] Install Install Packages and Tools" }
foreground {
    apt-get install -qy --no-install-recommends software-properties-common psmisc gnupg ca-certificates wget curl less vim-tiny aptitude dirmngr command-not-found
}

if { s6-echo "[xbuild] Execute System Upgrade" }
foreground {
    apt-get dist-upgrade -qy --no-install-recommends -o Dpkg::Options::="--force-confold"
}

exit 0
